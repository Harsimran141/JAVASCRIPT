<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>

    <div class="w-[550px] h-[315px] bg-gray-200 m-auto mt-4 rounded-md   ">
        <h1 class="text-center text-2xl text-blue-600 font-bold">User Chat</h1>
        <div class="mt-40">
            <input id="input" class="ml-4 mt-20 ml-20 w-[400px] h-[35px] rounded-md" type="text">
            <button id="btn" class="bg-blue-500 p-2 rounded-md ml-2 text-white font-medium">Send</button>
        </div>
    </div>
    <script>
        const usertoken = localStorage.getItem("record")
        console.log("token", usertoken);
        const token = JSON.parse(usertoken)
        console.log(token);

        const input = document.getElementById("input");
        const send = document.getElementById("btn");
        send.addEventListener("click", () => {
            let newsent = input.value;
            sendMessage()
            console.log("sent", newsent);

        })
        async function createchat() {
            let option = {
                method: "POST",
                headers: {
                    acept: 'application/json',
                    'content-type': 'application/json',
                    Authorization: `Bearer ${token.data.accessToken}`,
                }

            }
            let store = localStorage.getItem("userid")
            console.log("singh", store);

            try {
                let response = await fetch(`https://api.freeapi.app/api/v1/chat-app/chats/c/${store}`, option)
                let chat = await response.json()
                console.log("har", chat);
                localStorage.setItem("chatid", chat.data._id)
                getMessage()
            } catch (e) {
                console.log(e);

            }

        }
        createchat()
        async function getMessage() {

            let option = {
                method: "GET",
                headers: {

                    acept: 'application/json',
                    'content-type': 'application/json',
                    Authorization: `Bearer ${token.data.accessToken}`,
                }
            }
            try {
                let newlocal = localStorage.getItem("chatid")
                let response = await fetch(`https://api.freeapi.app/api/v1/chat-app/messages/${newlocal}`, option)
            } catch (error) {
                console.log(error);
            }

        }
        async function sendMessage() {
            let option = {
                method: "POST",
                headers: {

                    acept: 'application/json',
                    'content-type': 'application/json',
                    Authorization: `Bearer ${token.data.accessToken}`,
                },
                body:JSON.stringify({content:"hello"})
                    
                
            }
            try{
                let sendstore = localStorage.getItem("chatid")
                let response = await fetch(`https://api.freeapi.app/api/v1/chat-app/messages/${sendstore}`,option)
            }catch(e){
                console.log(e);
                
            }
        }
    </script>
</body>
</html>